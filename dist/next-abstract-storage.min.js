/*!
 * name: @feizheng/next-abstract-storage
 * description: An abstract storage based on next.
 * homepage: https://github.com/afeiship/next-abstract-storage
 * version: 2.1.0
 * date: 2020-07-06T10:42:24.983Z
 * license: MIT
 */
!function(){var e=e||this||window||Function("return this")(),r=e.nx||require("@feizheng/next-js-core2"),n="@",t=(r.json||require("@feizheng/next-json"),r.slice2str||require("@feizheng/next-slice2str"),r.declare("nx.AbstractStorage",{methods:{init:function(e){this.engine=e.engine,this.prefix=e.prefix||"",this.options=e,this.setAccessor()},setAccessor:function(){this.accessor={get:this.options.get||"getItem",set:this.options.set||"setItem",remove:this.options.remove||"removeItem",clear:this.options.clear||"clear"}},serialize:function(e){return r.stringify(e)},deserialize:function(e){return r.parse(e)},set:function(e,t){var i,s,n=e.indexOf(".");-1<n?(i=r.slice2str(e,n,1),s=this.get(i[0])||{},r.set(s,i[1],t),this.set(i[0],s)):this.engine[this.accessor.set](this.__key(e),this.serialize(t))},sets:function(e){r.each(e,function(e,t){this.set(e,t)},this)},get:function(e){var t=e.indexOf(".");if(-1<t){var i=r.slice2str(e,t,1),s=this.get(i[0])||{};return r.get(s,i[1])}var n=this.engine[this.accessor.get](this.__key(e));return this.deserialize(n)},gets:function(e){var i={},t=this.__keys(e);return r.each(t,function(e,t){i[t]=this.get(t)},this),i},del:function(e){this.engine[this.accessor.remove](this.__key(e))},dels:function(e){var t=this.__keys(e);r.each(t,function(e,t){this.del(t)},this)},clear:function(){this.engine[this.accessor.clear]()},keys:function(){return Object.keys(this.engine)},__key:function(e){var t=this.prefix;return t?[t,n,e].join(""):e},__keys:function(e){var i,t,s=[];return Array.isArray(e)?e:(t=this.keys(),i=this.prefix.length+1,r.each(t,function(e,t){this.prefix&&0===t.indexOf(this.prefix+n)&&s.push(t.slice(i))},this),s.length?s:t)}}}));"undefined"!=typeof module&&module.exports&&(module.exports=t)}();